# US-COURSE-019: Tแบกm แบฉn vร Xuแบฅt bแบฃn lแบกi khรณa hแปc

## User Story Content

**Lร mแปt** Giรกo viรชn tแปฑ do-INDIVIDUAL

**Tรดi muแปn** tแบกm แบฉn khรณa hแปc ฤรฃ xuแบฅt bแบฃn khแปi Online Store vร cรณ thแป xuแบฅt bแบฃn lแบกi khi cแบงn tแบกi trang quแบฃn lรฝ khรณa hแปc

**ฤแป** kiแปm soรกt viแปc hiแปn thแป khรณa hแปc trรชn thแป trฦฐแปng mร khรดng mแบฅt dแปฏ liแปu hแปc viรชn ฤรฃ ฤฤng kรฝ


---

## Acceptance Criteria

### AC-1: Truy cแบญp chแปฉc nฤng tแบกm แบฉn khรณa hแปc

**Tแบกi** trang chi tiแบฟt hoแบทc danh sรกch khรณa hแปc cรณ trแบกng thรกi ฤรฃ xuแบฅt bแบฃn - PUBLISHED

**Khi** Giรกo viรชn click nรบt "Tแบกm แบฉn" hoแบทc icon tแบกm แบฉn

**Thรฌ** hแป thแปng hiแปn thแป dialog xรกc nhแบญn vแปi nแปi dung thรดng tin vแป แบฃnh hฦฐแปng cแปงa viแปc tแบกm แบฉn

---

### AC-2: Xรกc nhแบญn tแบกm แบฉn khรณa hแปc

**Tแบกi** dialog xรกc nhแบญn tแบกm แบฉn

**Khi** dialog hiแปn thแป

**Thรฌ** hแป thแปng hiแปn thแป:
- Tiรชu ฤแป: "Tแบกm แบฉn khรณa hแปc"
- Thรดng tin: Tรชn khรณa hแปc, Sแป hแปc viรชn ฤรฃ ฤฤng kรฝ
- Cแบฃnh bรกo: "Khรณa hแปc sแบฝ khรดng hiแปn thแป trรชn Online Store. Hแปc viรชn ฤรฃ ฤฤng kรฝ vแบซn cรณ thแป tiแบฟp tแปฅc hแปc."
- Trฦฐแปng nhแบญp lรฝ do (tรนy chแปn)
- Nรบt "Hแปงy" vร "Xรกc nhแบญn tแบกm แบฉn"

---

### AC-3: Thแปฑc hiแปn tแบกm แบฉn thรnh cรดng

**Tแบกi** dialog xรกc nhแบญn tแบกm แบฉn

**Khi** Giรกo viรชn click "Xรกc nhแบญn tแบกm แบฉn"

**Thรฌ** hแป thแปng thแปฑc hiแปn:
1. Cแบญp nhแบญt trแบกng thรกi khรณa hแปc = ฤรฃ แบฉn - UNPUBLISHED
2. Cแบญp nhแบญt PIM status = UNPUBLISHED trรชn dแปch vแปฅ quแบฃn lรฝ sแบฃn phแบฉm
4. Ghi log vแปi lรฝ do tแบกm แบฉn (nแบฟu cรณ)
5. Hiแปn thแป thรดng bรกo "Khรณa hแปc ฤรฃ ฤฦฐแปฃc tแบกm แบฉn thรnh cรดng"
6. Cแบญp nhแบญt UI hiแปn thแป trแบกng thรกi mแปi ฤรฃ แบฉn - UNPUBLISHED

---

### AC-4: Khรณa hแปc khรดng hiแปn thแป trรชn Online Store

**Tแบกi** Online Store sau khi tแบกm แบฉn

**Khi** hแปc viรชn mแปi truy cแบญp hoแบทc tรฌm kiแบฟm

**Thรฌ** khรณa hแปc khรดng xuแบฅt hiแปn trong: kแบฟt quแบฃ tรฌm kiแบฟm, danh sรกch khรณa hแปc, trang category. Nแบฟu truy cแบญp trแปฑc tiแบฟp bแบฑng URL cลฉ, hiแปn thแป "Khรณa hแปc hiแปn khรดng khแบฃ dแปฅng"

---

### AC-5: Hแปc viรชn ฤรฃ ฤฤng kรฝ vแบซn cรณ thแป hแปc

**Tแบกi** trang hแปc tแบญp cแปงa hแปc viรชn ฤรฃ ฤฤng kรฝ

**Khi** khรณa hแปc bแป tแบกm แบฉn

**Thรฌ** hแปc viรชn vแบซn: thแบฅy khรณa hแปc trong "Khรณa hแปc cแปงa tรดi", truy cแบญp ฤฦฐแปฃc nแปi dung bรi hแปc, tiแบฟp tแปฅc tiแบฟn ฤแป hแปc tแบญp, nhแบญn chแปฉng chแป khi hoรn thรnh

---

### AC-6: Truy cแบญp chแปฉc nฤng xuแบฅt bแบฃn lแบกi

**Tแบกi** trang chi tiแบฟt hoแบทc danh sรกch khรณa hแปc cรณ trแบกng thรกi ฤรฃ แบฉn - UNPUBLISHED

**Khi** Giรกo viรชn click nรบt "Xuแบฅt bแบฃn lแบกi"

**Thรฌ** hแป thแปng hiแปn thแป dialog xรกc nhแบญn xuแบฅt bแบฃn lแบกi

---

### AC-7: Xรกc nhแบญn xuแบฅt bแบฃn lแบกi

**Tแบกi** dialog xรกc nhแบญn xuแบฅt bแบฃn lแบกi

**Khi** dialog hiแปn thแป

**Thรฌ** hแป thแปng hiแปn thแป:
- Tiรชu ฤแป: "Xuแบฅt bแบฃn lแบกi khรณa hแปc"
- Thรดng tin: Tรชn khรณa hแปc, Thแปi gian tแบกm แบฉn, Sแป hแปc viรชn hiแปn tแบกi
- Thรดng bรกo: "Khรณa hแปc sแบฝ hiแปn thแป lแบกi trรชn Online Store. Khรดng cแบงn validate lแบกi ฤiแปu kiแปn."
- Nรบt "Hแปงy" vร "Xรกc nhแบญn xuแบฅt bแบฃn"

---

### AC-8: Thแปฑc hiแปn xuแบฅt bแบฃn lแบกi thรnh cรดng

**Tแบกi** dialog xรกc nhแบญn xuแบฅt bแบฃn lแบกi

**Khi** Giรกo viรชn click "Xรกc nhแบญn xuแบฅt bแบฃn"

**Thรฌ** hแป thแปng thแปฑc hiแปn:
1. Cแบญp nhแบญt course.status = ฤรฃ xuแบฅt bแบฃn - PUBLISHED
2. Cแบญp nhแบญt PIM status = ฤรฃ xuแบฅt bแบฃn - PUBLISHED trรชn dแปch vแปฅ quแบฃn lรฝ sแบฃn phแบฉm
3. Hiแปn thแป thรดng bรกo "Khรณa hแปc ฤรฃ ฤฦฐแปฃc xuแบฅt bแบฃn lแบกi thรnh cรดng"
4. Hiแปn thแป link ฤแบฟn khรณa hแปc trรชn Online Store

---

### AC-9: Gแปญi email thรดng bรกo cho hแปc viรชn khi xuแบฅt bแบฃn lแบกi

**Tแบกi** sau khi xuแบฅt bแบฃn lแบกi thรnh cรดng

**Khi** khรณa hแปc cรณ hแปc viรชn ฤรฃ ฤฤng kรฝ trฦฐแปc ฤรณ

**Thรฌ** hแป thแปng gแปญi email thรดng bรกo ฤแบฟn cรกc hแปc viรชn vแปi nแปi dung: Khรณa hแปc ฤรฃ hoแบกt ฤแปng trแป lแบกi, Link truy cแบญp khรณa hแปc, Khuyแบฟn khรญch tiแบฟp tแปฅc hแปc tแบญp

---

## Alternative Paths

### ALT-1: Tแบกm แบฉn khรณa hแปc khรดng cรณ hแปc viรชn

**Tแบกi** dialog xรกc nhแบญn tแบกm แบฉn khรณa hแปc chฦฐa cรณ hแปc viรชn ฤฤng kรฝ

**Khi** Giรกo viรชn xรกc nhแบญn tแบกm แบฉn

**Thรฌ** hแป thแปng thแปฑc hiแปn tแบกm แบฉn bรฌnh thฦฐแปng, khรดng hiแปn thแป cแบฃnh bรกo vแป hแปc viรชn, khรดng gแปญi email thรดng bรกo

---

### ALT-2: Chuyแปn vแป DRAFT thay vรฌ xuแบฅt bแบฃn lแบกi

**Tแบกi** trang chi tiแบฟt khรณa hแปc ฤรฃ แบฉn - UNPUBLISHED

**Khi** Giรกo viรชn muแปn chแปnh sแปญa lแปn (major edits) trฦฐแปc khi xuแบฅt bแบฃn lแบกi

**Thรฌ** hแป thแปng cung cแบฅp option "Chuyแปn vแป Bแบฃn nhรกp" ฤแป chuyแปn course.status = DRAFT, cho phรฉp chแปnh sแปญa khรดng giแปi hแบกn, khi xuแบฅt bแบฃn lแบกi sแบฝ phแบฃi validate lแบกi

---

### ALT-3: Tแบกm แบฉn vแปi thรดng bรกo cho hแปc viรชn

**Tแบกi** dialog xรกc nhแบญn tแบกm แบฉn

**Khi** Giรกo viรชn tick checkbox "Thรดng bรกo cho hแปc viรชn ฤรฃ ฤฤng kรฝ"

**Thรฌ** hแป thแปng gแปญi email ฤแบฟn hแปc viรชn vแปi nแปi dung: Khรณa hแปc tแบกm thแปi khรดng nhแบญn ฤฤng kรฝ mแปi, Hแปc viรชn vแบซn cรณ thแป tiแบฟp tแปฅc hแปc, Lรฝ do tแบกm แบฉn (nแบฟu Giรกo viรชn nhแบญp)

---

### ALT-4: Xuแบฅt bแบฃn lแบกi vแปi cแบญp nhแบญt nแปi dung

**Tแบกi** trฦฐแปc khi xuแบฅt bแบฃn lแบกi

**Khi** Giรกo viรชn ฤรฃ thแปฑc hiแปn mแปt sแป chแปnh sแปญa nhแป (minor updates) trong thแปi gian ฤรฃ แบฉn - UNPUBLISHED

**Thรฌ** hแป thแปng cho phรฉp xuแบฅt bแบฃn lแบกi vแปi nแปi dung ฤรฃ cแบญp nhแบญt mร khรดng cแบงn validate lแบกi (vรฌ cแบฅu trรบc khรดng thay ฤแปi)

---

## Edge Cases & Error Conditions

### ERR-1: Cรณ giao dแปch ฤang pending

**Tแบกi** dialog xรกc nhแบญn tแบกm แบฉn

**Khi** khรณa hแปc cรณ giao dแปch thanh toรกn ฤang pending (chฦฐa hoรn tแบฅt)

**Thรฌ** hแป thแปng hiแปn thแป cแบฃnh bรกo "Cรณ [N] giao dแปch ฤang chแป xแปญ lรฝ. Tแบกm แบฉn cรณ thแป แบฃnh hฦฐแปng ฤแบฟn cรกc giao dแปch nรy. Bแบกn cรณ chแบฏc chแบฏn?", cho phรฉp tiแบฟp tแปฅc hoแบทc hแปงy

---

### ERR-2: Lแปi khi cแบญp nhแบญt PIM

**Tแบกi** ฤang thแปฑc hiแปn tแบกm แบฉn/xuแบฅt bแบฃn lแบกi

**Khi** khรดng thแป cแบญp nhแบญt status trรชn dแปch vแปฅ quแบฃn lรฝ sแบฃn phแบฉm

**Thรฌ** hแป thแปng retry 3 lแบงn, nแบฟu thแบฅt bแบกi thรฌ rollback course.status, hiแปn thแป lแปi "Khรดng thแป cแบญp nhแบญt trแบกng thรกi. Vui lรฒng thแปญ lแบกi sau"

---

### ERR-3: Concurrent requests

**Tแบกi** ฤang thแปฑc hiแปn tแบกm แบฉn

**Khi** cรณ request khรกc (tแปซ tab/device khรกc) cรนng thao tรกc

**Thรฌ** hแป thแปng sแปญ dแปฅng optimistic locking, request sau nhแบญn lแปi "Khรณa hแปc ฤang ฤฦฐแปฃc cแบญp nhแบญt. Vui lรฒng tแบฃi lแบกi trang"

---

### ERR-4: Khรณa hแปc ฤรฃ bแป archive

**Tแบกi** ฤang cแป tแบกm แบฉn

**Khi** khรณa hแปc ฤรฃ chuyแปn sang ARCHIVED bแปi process khรกc

**Thรฌ** hแป thแปng hiแปn thแป thรดng bรกo "Khรณa hแปc ฤรฃ ฤฦฐแปฃc lฦฐu trแปฏ. Khรดng thแป thแปฑc hiแปn thao tรกc nรy" vร refresh trang

---

### ERR-5: Session hแบฟt hแบกn

**Tแบกi** ฤang thแปฑc hiแปn tแบกm แบฉn/xuแบฅt bแบฃn lแบกi

**Khi** session cแปงa Giรกo viรชn hแบฟt hแบกn

**Thรฌ** hแป thแปng hiแปn thแป thรดng bรกo "Phiรชn lรm viแปc ฤรฃ hแบฟt hแบกn. Vui lรฒng ฤฤng nhแบญp lแบกi ฤแป tiแบฟp tแปฅc", redirect ฤแบฟn trang login

---

## Inline Business Rules

| Trฦฐแปng thรดng tin | Mรฃ BR | Business Rule | Ghi chรบ |
|-----------------|-------|---------------|---------|
| Trแบกng thรกi | BR_001 | Chแป khรณa hแปc ฤรฃ xuแบฅt bแบฃn - PUBLISHED mแปi cรณ thแป tแบกm แบฉn | Valid source: ฤรฃ xuแบฅt bแบฃn - PUBLISHED |
| Trแบกng thรกi | BR_002 | Chแป khรณa hแปc ฤรฃ แบฉn - UNPUBLISHED mแปi cรณ thแป xuแบฅt bแบฃn lแบกi | Valid source: UNPUBLISHED |
| Enrollment | BR_003 | Enrollment khรดng bแป แบฃnh hฦฐแปng khi tแบกm แบฉn | Giแปฏ nguyรชn access |
| PIM | BR_004 | PIM status phแบฃi ฤแปng bแป vแปi course status | ฤรฃ xuแบฅt bแบฃn - PUBLISHED โ ฤรฃ แบฉn - PUBLISHED |
| Lรฝ do | BR_005 | Lรฝ do tแบกm แบฉn lร tรนy chแปn, tแปi ฤa 500 kรฝ tแปฑ | Ghi vรo audit log |
| Validation | BR_006 | Xuแบฅt bแบฃn lแบกi khรดng cแบงn validate lแบกi ฤiแปu kiแปn | Skip validation |

---

## System Rules

1. Tแบกm แบฉn/Xuแบฅt bแบฃn lแบกi lร atomic operation, khรดng cho phรฉp partial update
2. Event phแบฃi ฤฦฐแปฃc publish sau khi database transaction commit thรnh cรดng
3. Audit log phแบฃi ghi nhแบญn: user_id, action, timestamp, reason (nแบฟu cรณ)
4. PIM vร Course status phแบฃi luรดn consistent
5. Email thรดng bรกo ฤฦฐแปฃc gแปญi qua message queue, khรดng block main flow

---

## Business Value & Success Metrics

Story nรy cung cแบฅp khแบฃ nฤng linh hoแบกt cho Giรกo viรชn trong viแปc quแบฃn lรฝ lifecycle khรณa hแปc, hแป trแปฃ cรกc tรฌnh huแปng nhฦฐ cแบญp nhแบญt nแปi dung, tแบกm ngแปซng bรกn trong mรนa thแบฅp ฤiแปm.

**Trแปng sแป cแปงa story nรy lร:** Trung bรฌnh (Flexibility)

Story ฤฦฐแปฃc coi lร thรnh cรดng khi ฤแบฃm bแบฃo ฤฦฐแปฃc:

- 100% enrollment ฤฦฐแปฃc giแปฏ nguyรชn khi tแบกm แบฉn
- Thแปi gian tแบกm แบฉn/xuแบฅt bแบฃn lแบกi < 5 giรขy
- 0% data inconsistency giแปฏa Course vร PIM
- Hแปc viรชn ฤรฃ ฤฤng kรฝ khรดng bแป giรกn ฤoแบกn hแปc tแบญp

---

## Dependencies

| Loแบกi | Mรด tแบฃ | Ghi chรบ |
|------|-------|---------|
| Service | dแปch vแปฅ quแบฃn lรฝ khรณa hแปc | Cแบญp nhแบญt course status |
| Service | dแปch vแปฅ quแบฃn lรฝ sแบฃn phแบฉm | Cแบญp nhแบญt PIM status |
| Service | Kafka | Publish events |
| Service | Email service | Gแปญi thรดng bรกo |
| US | US-COURSE-017 | Khรณa hแปc phแบฃi ฤฦฐแปฃc publish trฦฐแปc |

---

## Impact Analysis

| ฤแปi tฦฐแปฃng แบฃnh hฦฐแปng | Mรด tแบฃ แบฃnh hฦฐแปng |
|---------------------|-----------------|
| Giรกo viรชn INDIVIDUAL | Cรณ khแบฃ nฤng kiแปm soรกt visibility cแปงa khรณa hแปc |
| Hแปc viรชn ฤรฃ ฤฤng kรฝ | Vแบซn cรณ thแป tiแบฟp tแปฅc hแปc, nhแบญn thรดng bรกo khi xuแบฅt bแบฃn lแบกi |
| Hแปc viรชn mแปi | Khรดng thแป tรฌm thแบฅy vร ฤฤng kรฝ khรณa hแปc bแป tแบกm แบฉn |
| Online Store | Catalog ฤฦฐแปฃc cแบญp nhแบญt real-time |

---

## Email Templates

### Email thรดng bรกo tแบกm แบฉn (Tรนy chแปn - khi Giรกo viรชn chแปn gแปญi)

**Subject:** Thรดng bรกo vแป khรณa hแปc "[Tiรชu ฤแป khรณa hแปc]"

**Body:**
```
Xin chรo [Tรชn hแปc viรชn],

Khรณa hแปc "[Tiรชu ฤแป khรณa hแปc]" mร bแบกn ฤรฃ ฤฤng kรฝ hiแปn ฤang tแบกm thแปi khรดng nhแบญn ฤฤng kรฝ mแปi.

๐ Lฦฐu รฝ quan trแปng:
- Bแบกn VแบชN Cร THแป tiแบฟp tแปฅc hแปc khรณa hแปc nรy bรฌnh thฦฐแปng
- Tiแบฟn ฤแป hแปc tแบญp cแปงa bแบกn ฤฦฐแปฃc giแปฏ nguyรชn
- Tแบฅt cแบฃ nแปi dung vแบซn cรณ thแป truy cแบญp

[Lรฝ do tแปซ Giรกo viรชn - nแบฟu cรณ]

Nแบฟu bแบกn cรณ thแบฏc mแบฏc, vui lรฒng liรชn hแป Giรกo viรชn hoแบทc hแป trแปฃ.

Trรขn trแปng,
ฤแปi ngลฉ EduEcosystem
```

**Trong ฤรณ**
- [Tรชn hแปc viรชn]: Tรชn ngฦฐแปi mua khรณa hแปc trรชn Online store
- [Tiรชu ฤแป khรณa hแปc]: Tiรชu ฤแป khรณa hแปc bแป tแบกm แบฉn
- [Lรฝ do tแปซ Giรกo viรชn - nแบฟu cรณ]: Lรฝ do ฤฦฐแปฃc nhแบญp khi Tแบกm แบฉn khรณa hแปc

### Email thรดng bรกo xuแบฅt bแบฃn lแบกi

**Subject:** Khรณa hแปc "[Tiรชu ฤแป khรณa hแปc]" ฤรฃ hoแบกt ฤแปng trแป lแบกi!

**Body:**
```
Xin chรo [Tรชn hแปc viรชn],

Tin vui! Khรณa hแปc "[Tiรชu ฤแป khรณa hแปc]" ฤรฃ hoแบกt ฤแปng trแป lแบกi trรชn EduEcosystem.

๐ Truy cแบญp ngay: [Link khรณa hแปc]

๐ Tiแบฟn ฤแป cแปงa bแบกn: [X]% hoรn thรnh

Hรฃy tiแบฟp tแปฅc hแปc tแบญp vร hoรn thรnh khรณa hแปc nhรฉ!

Trรขn trแปng,
ฤแปi ngลฉ EduEcosystem
```

**Trong ฤรณ**
- [Tรชn hแปc viรชn]: Tรชn ngฦฐแปi mua khรณa hแปc trรชn Online store
- [Tiรชu ฤแป khรณa hแปc]: Tiรชu ฤแป khรณa hแปc ฤฦฐแปฃc xuแบฅt bแบฃn lแบกi
- [Link khรณa hแปc]: Link truy cแบญp vรo khรณa hแปc trรชn Online store
- Tiแบฟn ฤแป hแปc tแบญp [X]: % tiแบฟn ฤแป hแปc tแบญp khรณa hแปc

---

## UI/UX Design

### Mรด tแบฃ UI chรญnh

**Nรบt Tแบกm แบฉn (trรชn trang PUBLISHED):**
- Vแป trรญ: Header hoแบทc dropdown actions
- Style: Secondary button hoแบทc icon (mแบฏt gแบกch chรฉo)
- Text: "Tแบกm แบฉn" hoแบทc "Unpublish"

**Dialog Xรกc nhแบญn Tแบกm แบฉn:**
- Title: "Tแบกm แบฉn khรณa hแปc"
- Icon: Warning
- Info card: Tรชn khรณa hแปc, Sแป hแปc viรชn ฤรฃ ฤฤng kรฝ
- Warning text vแปi highlight vรng
- Textarea: "Lรฝ do tแบกm แบฉn (tรนy chแปn)"
- Checkbox: "Thรดng bรกo cho hแปc viรชn ฤรฃ ฤฤng kรฝ"
- Footer: Nรบt "Hแปงy" (outline) | "Xรกc nhแบญn tแบกm แบฉn" (danger)

**Nรบt Xuแบฅt bแบฃn lแบกi (trรชn trang UNPUBLISHED):**
- Vแป trรญ: Header, prominent
- Style: Primary button mรu xanh lรก
- Text: "Xuแบฅt bแบฃn lแบกi"

**Dialog Xรกc nhแบญn Xuแบฅt bแบฃn lแบกi:**
- Title: "Xuแบฅt bแบฃn lแบกi khรณa hแปc"
- Icon: Info
- Info card: Tรชn khรณa hแปc, Thแปi gian tแบกm แบฉn
- Note: "Khรณa hแปc sแบฝ hiแปn thแป lแบกi trรชn Online Store"
- Footer: Nรบt "Hแปงy" | "Xรกc nhแบญn xuแบฅt bแบฃn"

**Badge trแบกng thรกi:**
- PUBLISHED: Badge xanh lรก "ฤรฃ xuแบฅt bแบฃn"
- UNPUBLISHED: Badge vรng "Tแบกm แบฉn"

---

## Out of Scope Items

| Item | Lรฝ do |
|------|-------|
| Lรชn lแปch tแบกm แบฉn/xuแบฅt bแบฃn lแบกi tแปฑ ฤแปng | Phแบกm vi phase sau |
| Tแบกm แบฉn theo vรนng ฤแปa lรฝ | Khรดng hแป trแปฃ trong MVP |
| Tแบกm แบฉn mแปt phแบงn nแปi dung | Phแบฃi tแบกm แบฉn toรn bแป khรณa hแปc |
| Thรดng bรกo push notification | Chแป hแป trแปฃ email |
