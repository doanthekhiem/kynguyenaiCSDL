---
alwaysApply: true
---

# [PROJECT_NAME] Coding Rules Template

> **Hướng dẫn sử dụng template này:**
> 1. Thay thế tất cả placeholders `[UPPERCASE_TEXT]` bằng giá trị thực tế
> 2. Xóa các phần không áp dụng cho tech stack của bạn
> 3. Thêm quy tắc cụ thể cho framework/library bạn sử dụng
> 4. Xem các ví dụ trong `examples/coding-rules/` để tham khảo

---

## 1. Tổng quan dự án

### 1.1 Thông tin cơ bản
- **Tên dự án:** `[PROJECT_NAME]`
- **Ngôn ngữ:** `[LANGUAGE]` (Java, TypeScript, Python, etc.)
- **Framework chính:** `[FRAMEWORK]` (Spring Boot, NestJS, FastAPI, etc.)
- **Phiên bản:** `[VERSION]`
- **Base package/namespace:** `[BASE_PACKAGE]` (com.company.project, @company/project, etc.)

### 1.2 Công cụ build
- **Build tool:** `[BUILD_TOOL]` (Gradle, npm, Maven, pip, etc.)
- **Package manager:** `[PACKAGE_MANAGER]` (npm, yarn, pnpm, pip, etc.)
- **Package registry:** `[REGISTRY_URL]` (nếu có private registry)
  - Credentials: `[CREDENTIALS_ENV_VARS]`

### 1.3 Dependencies chính
Liệt kê các thư viện/framework chính:
- `[DEPENDENCY_1]` - [Mục đích]
- `[DEPENDENCY_2]` - [Mục đích]
- `[DEPENDENCY_3]` - [Mục đích]

### 1.4 Chế độ kiến trúc
- **Kiến trúc:** `[ARCHITECTURE_TYPE]`
  - Layered Architecture (mặc định)
  - Domain-Driven Design (DDD)
  - Hexagonal Architecture
  - Clean Architecture
  - Microservices
  - Monolithic

---

## 2. QUAN TRỌNG - Semantic Naming Rules

### 2.1 Nguyên tắc chung
- ✅ **Tên phải rõ ngữ nghĩa**: Mô tả đầy đủ mục đích và chức năng
- ❌ **Tránh tên chung chung**: Không dùng `create`, `update`, `process`, `handle`, `data`, `info`
- ✅ **Dùng tên cụ thể**: `createQuotationRequest`, `submitPurchaseOrder`, `validateUserEmail`

### 2.2 Quy tắc đặt tên theo loại

#### Class/Interface/Type
- **Format:** `[NAMING_CONVENTION]` (PascalCase, camelCase, snake_case, etc.)
- **Examples:**
  - `UserRegistrationService`
  - `PaymentGatewayInterface`
  - `OrderConfirmationEmail`

#### Methods/Functions
- **Format:** `[NAMING_CONVENTION]`
- **Examples:**
  - `calculateTotalOrderAmount()`
  - `sendWelcomeEmailToNewUser()`
  - `validateCreditCardNumber()`

#### Variables/Properties
- **Format:** `[NAMING_CONVENTION]`
- **Examples:**
  - `userEmailAddress`
  - `totalOrderAmount`
  - `isPaymentProcessed`

#### Constants
- **Format:** `UPPER_SNAKE_CASE`
- **Examples:**
  - `MAX_LOGIN_ATTEMPTS`
  - `DEFAULT_TIMEOUT_SECONDS`
  - `API_BASE_URL`

#### Database Fields
- **Format:** `snake_case`
- **Primary Key:** `id` (BIGSERIAL/BIGINT auto-increment)
- **Common fields:** `created_at`, `updated_at`, `created_by`, `updated_by`, `is_deleted`, `deleted_at`

---

## 3. API Design Rules

### 3.1 API URL Pattern

| Operation | HTTP Method | URL Pattern | Example |
|-----------|------------|-------------|---------|
| **Create** | POST | `/api/v1/{resource}` | `POST /api/v1/orders` |
| **Get by ID** | GET | `/api/v1/{resource}/{id}` | `GET /api/v1/orders/123` |
| **Simple Search** | GET | `/api/v1/{resource}/search` | `GET /api/v1/products/search?q=laptop` |
| **Advanced Search** | POST | `/api/v1/{resource}/search` | `POST /api/v1/orders/search` (body: filters) |
| **List subresource** | GET | `/api/v1/{resource}/{sub}/list` | `GET /api/v1/products/featured/list` |
| **Action with ID** | POST | `/api/v1/{resource}/{id}/{action}` | `POST /api/v1/orders/123/cancel` |
| **Action with sub** | POST | `/api/v1/{resource}/{id}/{sub}/{action}` | `POST /api/v1/cart/456/items/remove` |
| **Action no ID** | POST | `/api/v1/{resource}/{action}` | `POST /api/v1/auth/login` |

**Nguyên tắc:**
- Create và Get by ID: KHÔNG cần action suffix
- Tất cả operations khác: PHẢI có action suffix rõ nghĩa
- Action suffix examples: `cancel`, `approve`, `reject`, `submit`, `claim`, `merge`, `migrate`

### 3.2 HTTP Status Codes
- **200 OK**: Thành công (Create, Update, Delete đều trả 200)
- **400 Bad Request**: Validation error
- **401 Unauthorized**: Chưa authentication
- **403 Forbidden**: Không có permission
- **404 Not Found**: Resource không tồn tại
- **500 Internal Server Error**: Lỗi server

### 3.3 Request/Response Format
```json
// Request (POST /api/v1/orders)
{
  "customerEmail": "user@example.com",
  "items": [
    {"productId": 123, "quantity": 2}
  ],
  "shippingAddress": {...}
}

// Response (Success)
{
  "id": 456,
  "status": "PENDING",
  "message": "Order created successfully"
}

// Response (Error)
{
  "error": "VALIDATION_ERROR",
  "message": "EMAIL_INVALID",
  "details": [
    {"field": "customerEmail", "code": "EMAIL_FORMAT_INVALID"}
  ]
}
```

### 3.4 Search Request Pattern

**Simple Search** (GET với query params):
```
GET /api/v1/products/search?category=laptop&minPrice=1000&maxPrice=2000&page=1&size=20
```

**Advanced Search** (POST với body):
```json
POST /api/v1/orders/search
{
  "filters": {
    "status": ["PENDING", "PROCESSING"],
    "dateRange": {"from": "2024-01-01", "to": "2024-12-31"},
    "customerEmail": "user@example.com"
  },
  "pagination": {"page": 1, "size": 20},
  "sorting": [{"field": "createdAt", "direction": "DESC"}]
}
```

---

## 4. Code Structure & Architecture

### 4.1 Project Structure

```
[PROJECT_ROOT]/
├── [SOURCE_FOLDER]/              # src/, app/, lib/, etc.
│   ├── [LAYER_1]/                # Ví dụ: api/, controllers/, presentation/
│   ├── [LAYER_2]/                # Ví dụ: application/, usecases/, services/
│   ├── [LAYER_3]/                # Ví dụ: domain/, models/, entities/
│   └── [LAYER_4]/                # Ví dụ: infrastructure/, repositories/, data/
├── [TEST_FOLDER]/                # test/, tests/, __tests__/
├── [CONFIG_FOLDER]/              # config/, configs/
└── [BUILD_CONFIG]                # package.json, build.gradle, requirements.txt
```

### 4.2 Layered Architecture (Default)

**Layers:**
1. **Presentation Layer** (`[PRESENTATION_LAYER]`): Controllers, Routers, API Endpoints
2. **Application Layer** (`[APPLICATION_LAYER]`): Services, Use Cases, Business Logic
3. **Domain Layer** (`[DOMAIN_LAYER]`): Entities, Models, Domain Objects
4. **Infrastructure Layer** (`[INFRASTRUCTURE_LAYER]`): Repositories, Database, External Services

**Dependencies:**
- Presentation → Application → Domain ← Infrastructure
- Infrastructure có thể phụ thuộc vào Domain (implement interfaces)

### 4.3 Module/Package Organization

**By Feature** (Recommended):
```
[SOURCE_FOLDER]/
├── users/
│   ├── [CONTROLLER_FILE]
│   ├── [SERVICE_FILE]
│   ├── [REPOSITORY_FILE]
│   ├── [ENTITY_FILE]
│   └── [DTO_FILES]
├── orders/
│   ├── [CONTROLLER_FILE]
│   ├── [SERVICE_FILE]
│   └── ...
```

**By Layer** (Alternative):
```
[SOURCE_FOLDER]/
├── [CONTROLLERS]/
│   ├── UserController
│   └── OrderController
├── [SERVICES]/
│   ├── UserService
│   └── OrderService
├── [REPOSITORIES]/
│   ├── UserRepository
│   └── OrderRepository
```

---

## 5. Database & ORM Rules

### 5.1 ORM Framework
- **ORM:** `[ORM_FRAMEWORK]` (JPA/Hibernate, TypeORM, Sequelize, SQLAlchemy, etc.)
- **Database:** `[DATABASE]` (PostgreSQL, MySQL, MongoDB, etc.)
- **Migration tool:** `[MIGRATION_TOOL]` (Liquibase, Flyway, Alembic, Prisma Migrate, etc.)

### 5.2 Entity Design

**Common Fields** (cho tất cả entities):
```
- id: [PRIMARY_KEY_TYPE] (BIGSERIAL, UUID, etc.)
- created_at: TIMESTAMP
- updated_at: TIMESTAMP
- created_by: [USER_ID_TYPE]
- updated_by: [USER_ID_TYPE]
- is_deleted: BOOLEAN (cho soft delete)
- deleted_at: TIMESTAMP (nullable)
```

**Multi-tenant Support** (nếu có):
```
- tenant_id: [TENANT_ID_TYPE]
```

### 5.3 Naming Conventions

- **Table names:** `snake_case` (users, order_items, product_categories)
- **Column names:** `snake_case` (user_email, created_at, is_active)
- **Foreign keys:** `{referenced_table}_id` (user_id, product_id)
- **Junction tables:** `{table1}_{table2}` (user_roles, product_categories)
- **Indexes:** `idx_{table}_{column(s)}` (idx_users_email, idx_orders_status_created_at)

### 5.4 Query Rules

- ✅ **Dùng ORM query builder**: Tránh raw SQL trừ khi thực sự cần thiết
- ✅ **Pagination**: Luôn có pagination cho list APIs (default: page=1, size=20, max=100)
- ✅ **Indexing**: Tạo index cho các cột thường xuyên search/filter/sort
- ❌ **N+1 queries**: Sử dụng eager loading khi cần
- ✅ **Soft delete**: Sử dụng `is_deleted` flag thay vì hard delete

---

## 6. Exception Handling & Validation

### 6.1 Custom Exceptions

**Phải sử dụng custom exceptions**, KHÔNG dùng exception của framework/library:

```
[CUSTOM_EXCEPTION_EXAMPLES]:
- ValidationException
- ResourceNotFoundException
- DuplicateResourceException
- UnauthorizedException
- BusinessLogicException
```

### 6.2 Validation Layers

**1. Request Validation** (tại API layer):
- Sử dụng validation annotations/decorators của framework
- Message keys theo format: `UPPER_SNAKE_CASE`
- Examples: `EMAIL_INVALID`, `PASSWORD_TOO_SHORT`, `REQUIRED_FIELD_MISSING`

**2. Business Logic Validation** (tại Service layer):
- Sử dụng custom exceptions
- Message keys: `BUSINESS_RULE_VIOLATION`, `INSUFFICIENT_BALANCE`, `ORDER_ALREADY_PROCESSED`

### 6.3 Error Response Format

```json
{
  "error": "[ERROR_CODE]",
  "message": "[MESSAGE_KEY]",
  "details": [
    {
      "field": "[FIELD_NAME]",
      "code": "[VALIDATION_CODE]",
      "params": {}
    }
  ],
  "timestamp": "[ISO_TIMESTAMP]",
  "path": "[REQUEST_PATH]"
}
```

---

## 7. Service Layer Rules

### 7.1 Service Design

- **1 Service = 1 Bounded Context**: Service chỉ chứa repositories trong cùng bounded context
- **Cross-context communication**: Service-to-Service (không trực tiếp access repo của context khác)
- **Example:**
  - ✅ OrderService chứa OrderRepository + OrderItemRepository (cùng context)
  - ❌ OrderService chứa OrderRepository + CustomerRepository (khác context)
  - ✅ OrderService gọi CustomerService để lấy thông tin customer

### 7.2 Transaction Management

- Mỗi method **write operation** trong Service phải có error handling:
  ```
  try {
    // business logic
    return result;
  } catch (ValidationException e) {
    // Re-throw validation exceptions
    throw e;
  } catch (Exception e) {
    // Log and throw generic error
    log.error("Error executing operation", e);
    throw new ExecutionException("OPERATION_FAILED");
  }
  ```

---

## 8. Documentation & Comments

### 8.1 API Documentation

- **Tool:** `[API_DOC_TOOL]` (Swagger/OpenAPI, JSDoc, TypeDoc, etc.)
- **Requirement**: Tất cả APIs phải có documentation đầy đủ
  - Description (đủ ngữ cảnh để AI/LLM hiểu)
  - Request parameters/body
  - Response format
  - Error codes
  - Examples

### 8.2 Code Comments

- **Nguyên tắc**: Code phải tự giải thích (self-documenting)
- **Comment khi nào**:
  - Business logic phức tạp
  - Workarounds/hacks (giải thích tại sao)
  - TODO/FIXME với context đầy đủ

### 8.3 AI-Generated Code

**Tất cả code do AI generate phải có marker:**
```
[LANGUAGE_SPECIFIC_COMMENT_FORMAT]:
/**
 * [Description]
 *
 * @author AI
 * @param [param] [description]
 * @return [description]
 */
```

---

## 9. Testing Rules

### 9.1 Testing Framework
- **Unit test:** `[UNIT_TEST_FRAMEWORK]` (JUnit, Jest, Pytest, etc.)
- **Integration test:** `[INTEGRATION_TEST_FRAMEWORK]`
- **E2E test:** `[E2E_TEST_FRAMEWORK]` (optional)

### 9.2 Test Coverage
- **Minimum coverage:** `[COVERAGE_PERCENTAGE]%` (ví dụ: 80%)
- **Priority:**
  1. Business logic (services)
  2. Utility functions
  3. API endpoints
  4. Database queries

### 9.3 Test Naming Convention
- **Format:** `test_[methodName]_[scenario]_[expectedResult]`
- **Examples:**
  - `test_createOrder_withValidData_returnsOrderId`
  - `test_validateEmail_withInvalidFormat_throwsValidationException`

---

## 10. Security Rules

### 10.1 Authentication & Authorization
- **Authentication:** `[AUTH_METHOD]` (JWT, OAuth2, Session, etc.)
- **Authorization:** `[AUTHZ_METHOD]` (RBAC, ABAC, etc.)
- **Password hashing:** `[HASH_ALGORITHM]` (bcrypt, argon2, etc.)

### 10.2 Security Best Practices
- ❌ **KHÔNG bao giờ**:
  - Hard-code credentials/secrets
  - Log sensitive data (passwords, tokens, PII)
  - Expose stack traces trong production
  - Dùng SQL string concatenation (risk SQL injection)

- ✅ **LUÔN LUÔN**:
  - Validate và sanitize user input
  - Sử dụng environment variables cho secrets
  - Implement rate limiting cho APIs
  - Encrypt sensitive data at rest và in transit

---

## 11. Logging Rules

### 11.1 Log Levels
- **ERROR**: Lỗi nghiêm trọng cần xử lý ngay
- **WARN**: Vấn đề tiềm ẩn, cần theo dõi
- **INFO**: Thông tin quan trọng về luồng xử lý (dùng ít)
- **DEBUG**: Thông tin chi tiết cho debugging (dùng thay cho INFO)

### 11.2 Log Format
```
[TIMESTAMP] [LEVEL] [CONTEXT] [MESSAGE] [DATA]

Examples:
2024-01-09 10:30:45 DEBUG [OrderService.createOrder] Creating order for user: userId=123
2024-01-09 10:30:46 ERROR [OrderService.createOrder] Failed to create order: error=INSUFFICIENT_BALANCE
```

### 11.3 What to Log
- ✅ API requests/responses (without sensitive data)
- ✅ Business events (order created, payment processed, etc.)
- ✅ Errors with context (user ID, order ID, etc.)
- ❌ Passwords, tokens, credit card numbers
- ❌ Full request/response bodies (only log IDs/refs)

---

## 12. Performance & Optimization

### 12.1 Caching Strategy
- **Cache layer:** `[CACHE_TOOL]` (Redis, Memcached, in-memory, etc.)
- **Cache patterns:**
  - Cache-aside (lazy loading)
  - Write-through
  - Write-behind

### 12.2 Performance Rules
- ✅ Use pagination cho tất cả list APIs
- ✅ Implement database indexes cho search fields
- ✅ Use connection pooling
- ✅ Cache frequently accessed data
- ❌ Không load toàn bộ collection vào memory
- ❌ Không có N+1 query problems

---

## 13. Code Style & Formatting

### 13.1 Formatter
- **Tool:** `[FORMATTER_TOOL]` (Prettier, ESLint, Black, gofmt, etc.)
- **Config file:** `[CONFIG_FILE]` (.prettierrc, .eslintrc, etc.)
- **Format on save**: Enabled

### 13.2 Import Organization
- **Order:**
  1. Standard library imports
  2. Third-party library imports
  3. Internal/project imports
  4. Static imports (cuối cùng)
- **No wildcard imports** (trừ khi framework yêu cầu)

### 13.3 Line Length
- **Maximum:** `[MAX_LINE_LENGTH]` characters (80, 100, 120, etc.)

---

## 14. Version Control Rules

### 14.1 Branch Naming
- **Feature:** `feature/[TICKET-ID]-[short-description]`
- **Bugfix:** `bugfix/[TICKET-ID]-[short-description]`
- **Hotfix:** `hotfix/[TICKET-ID]-[short-description]`

### 14.2 Commit Message Format
```
[TYPE]([SCOPE]): [SHORT DESCRIPTION]

[OPTIONAL BODY]

[OPTIONAL FOOTER]

Examples:
feat(orders): add order cancellation API
fix(auth): resolve token expiration issue
docs(readme): update installation instructions
```

**Types:** feat, fix, docs, style, refactor, test, chore

---

## 15. Multi-tenant Support (Optional)

Nếu project hỗ trợ multi-tenant:

### 15.1 Tenant Isolation
- **Model:** `[TENANT_MODEL]` (Database per tenant, Schema per tenant, Row-level isolation)
- **Tenant identifier:** `[TENANT_ID_FIELD]` (tenant_id, organization_id, etc.)

### 15.2 Tenant Context
- **Header:** `X-Tenant-ID` hoặc `[CUSTOM_HEADER]`
- **Validation:** Mọi request phải có valid tenant ID
- **Isolation:** Queries phải luôn filter by tenant_id

---

## 16. Event-Driven Architecture (Optional)

Nếu project sử dụng event-driven:

### 16.1 Message Broker
- **Tool:** `[MESSAGE_BROKER]` (Kafka, RabbitMQ, AWS SQS, etc.)
- **Topic naming:** `[TOPIC_NAMING_PATTERN]` (domain.entity.event, etc.)

### 16.2 Event Schema
```json
{
  "eventId": "[UUID]",
  "eventType": "[EVENT_TYPE]",
  "eventVersion": "[VERSION]",
  "timestamp": "[ISO_TIMESTAMP]",
  "tenantId": "[TENANT_ID]",
  "data": {
    // Event-specific payload
  },
  "metadata": {
    "correlationId": "[UUID]",
    "causationId": "[UUID]"
  }
}
```

### 16.3 Event Naming
- **Format:** `[Entity][Action]Event`
- **Examples:**
  - `OrderCreatedEvent`
  - `PaymentProcessedEvent`
  - `UserRegisteredEvent`

---

## 17. CI/CD & Deployment

### 17.1 CI/CD Pipeline
- **Tool:** `[CI_CD_TOOL]` (Jenkins, GitHub Actions, GitLab CI, etc.)
- **Stages:**
  1. Lint & Format check
  2. Unit tests
  3. Integration tests
  4. Build
  5. Security scan
  6. Deploy to staging
  7. Deploy to production (manual approval)

### 17.2 Environment Variables
- **Development:** `.env.dev`
- **Staging:** `.env.staging`
- **Production:** Managed by `[ENV_MANAGER]` (AWS Secrets Manager, Vault, etc.)

---

## 18. Checklist cho Code Review

### Before submitting PR:
- [ ] Code tuân thủ naming conventions
- [ ] Tất cả APIs có documentation đầy đủ
- [ ] Unit tests coverage đạt minimum requirement
- [ ] Không có hard-coded secrets/credentials
- [ ] Error handling đầy đủ với custom exceptions
- [ ] Logging hợp lý (không log sensitive data)
- [ ] Code đã format theo style guide
- [ ] Database migrations có rollback script
- [ ] Performance optimization (pagination, indexing, caching)
- [ ] Security vulnerabilities đã được fix

---

## 19. AI Assistant Guidelines

Khi làm việc với AI assistants (Claude, ChatGPT, Copilot, etc.):

### 19.1 Context Providing
- Luôn cung cấp file này cho AI
- Reference specific sections khi cần
- Clarify requirements trước khi generate code

### 19.2 Code Generation
- AI-generated code phải tuân thủ 100% rules trong file này
- Phải có marker `@author AI` trong comments
- Review carefully trước khi commit

### 19.3 Unclear Requirements
- AI phải hỏi clarification questions nếu requirements mông lung
- Không tự ý assume business logic
- Đề xuất alternatives khi có nhiều cách implement

---

## Phụ lục: Tài liệu tham khảo

### Framework-specific Rules
- Xem `examples/coding-rules/CODING-RULES-JAVA-SPRING-BOOT.mdc` cho Java/Spring Boot
- Xem `examples/coding-rules/CODING-RULES-NODEJS-NESTJS.mdc` cho NodeJS/NestJS
- Xem `examples/coding-rules/CODING-RULES-FRONTEND-NEXTJS.mdc` cho Frontend/NextJS

### External Resources
- [Framework documentation]: `[FRAMEWORK_DOCS_URL]`
- [API design best practices]: `[API_DOCS_URL]`
- [Security guidelines]: `[SECURITY_DOCS_URL]`

---

**Template Version:** 1.0
**Created:** 2026-01-09
**Status:** Production-ready

**Note:** Template này là baseline. Customize theo needs cụ thể của project bạn.
