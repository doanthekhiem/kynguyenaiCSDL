---
alwaysApply: true
---

# Frontend NextJS + React Coding Rules

> Ví dụ coding rules cho Frontend project sử dụng Next.js + React + TypeScript

---

## 1. Tổng quan dự án

### 1.1 Thông tin cơ bản
- **Tên dự án:** `edu-online-store-web`
- **Ngôn ngữ:** TypeScript
- **Framework chính:** Next.js 14.x (App Router)
- **UI Library:** React 18.x
- **Phiên bản:** 1.0

### 1.2 Công cụ build
- **Package manager:** pnpm
- **Build tool:** Next.js built-in (Turbopack)
- **Runtime:** Node.js 20.x LTS

### 1.3 Dependencies chính
- `next` - Next.js framework
- `react`, `react-dom` - React library
- `@tanstack/react-query` - Data fetching & caching
- `zustand` - State management
- `tailwindcss` - Utility-first CSS
- `shadcn/ui` - UI component library
- `zod` - Schema validation
- `react-hook-form` - Form handling

### 1.4 Kiến trúc
- **Pattern:** Component-based, Feature-sliced Design
- **Rendering:** Server Components + Client Components (hybrid)
- **Data Fetching:** Server-side (RSC) + Client-side (React Query)

---

## 2. Project Structure

```
src/
├── app/                          # Next.js App Router
│   ├── (auth)/                   # Route group: Authentication
│   │   ├── login/
│   │   └── register/
│   ├── (shop)/                   # Route group: Shopping
│   │   ├── page.tsx              # Homepage (Server Component)
│   │   ├── products/
│   │   │   └── [id]/
│   │   │       └── page.tsx
│   │   ├── cart/
│   │   └── checkout/
│   ├── api/                      # API Routes (if needed)
│   │   └── auth/
│   ├── layout.tsx                # Root layout
│   └── globals.css
│
├── components/                    # Shared components
│   ├── ui/                       # Base UI components (shadcn/ui)
│   │   ├── button.tsx
│   │   ├── input.tsx
│   │   └── dialog.tsx
│   ├── common/                   # Common components
│   │   ├── Header.tsx
│   │   ├── Footer.tsx
│   │   └── Loading.tsx
│   └── features/                 # Feature-specific components
│       ├── cart/
│       │   ├── CartItem.tsx
│       │   ├── CartSummary.tsx
│       │   └── AddToCartButton.tsx
│       └── product/
│           ├── ProductCard.tsx
│           └── ProductList.tsx
│
├── lib/                          # Utilities & configurations
│   ├── api/                      # API client
│   │   ├── client.ts
│   │   ├── endpoints.ts
│   │   └── queries/              # React Query hooks
│   │       ├── useCart.ts
│   │       └── useProducts.ts
│   ├── stores/                   # Zustand stores
│   │   ├── authStore.ts
│   │   └── cartStore.ts
│   ├── utils/                    # Utility functions
│   │   ├── cn.ts                 # className merger
│   │   ├── formatters.ts
│   │   └── validators.ts
│   └── constants.ts
│
├── types/                        # TypeScript types
│   ├── api.types.ts
│   ├── cart.types.ts
│   └── product.types.ts
│
├── hooks/                        # Custom React hooks
│   ├── useAuth.ts
│   ├── useCart.ts
│   └── useDebounce.ts
│
└── config/
    ├── site.ts                   # Site metadata
    └── env.ts                    # Environment variables
```

---

## 3. Naming Conventions

### 3.1 Files & Folders
- **Components:** PascalCase - `ProductCard.tsx`, `CartSummary.tsx`
- **Utilities:** camelCase - `formatPrice.ts`, `validateEmail.ts`
- **Hooks:** camelCase with `use` prefix - `useCart.ts`, `useDebounce.ts`
- **Types:** camelCase with `.types.ts` suffix - `product.types.ts`
- **Constants:** camelCase - `apiEndpoints.ts`, `config.ts`
- **Styles:** kebab-case - `product-card.module.css`

### 3.2 Components

```typescript
// ✅ CORRECT: PascalCase for components
export function ProductCard({ product }: ProductCardProps) {}
export const CartSummary: React.FC<CartSummaryProps> = ({ items }) => {};

// ❌ WRONG: camelCase for components
export function productCard() {} // WRONG
```

### 3.3 Variables & Functions
- **Format:** camelCase
- **Examples:**
  - `productList`, `cartTotal`, `isLoading`, `hasError`
  - `calculateTotalPrice()`, `formatCurrency()`, `validateCartItem()`

### 3.4 Constants & Enums
```typescript
// Constants
export const MAX_CART_ITEMS = 100;
export const DEFAULT_PAGE_SIZE = 20;
export const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL;

// Enums
export enum CartStatus {
  ACTIVE = 'ACTIVE',
  MERGED = 'MERGED',
  ABANDONED = 'ABANDONED',
}
```

---

## 4. Component Design Rules

### 4.1 Server Components (Default)

```typescript
// app/(shop)/products/[id]/page.tsx
import { getProductById } from '@/lib/api/products';
import { ProductDetail } from '@/components/features/product/ProductDetail';

/**
 * Product detail page - Server Component
 *
 * @author AI
 */
export default async function ProductPage({ params }: { params: { id: string } }) {
  // Data fetching on server
  const product = await getProductById(params.id);

  if (!product) {
    notFound();
  }

  return (
    <div className="container mx-auto py-8">
      <ProductDetail product={product} />
    </div>
  );
}
```

### 4.2 Client Components

```typescript
// components/features/cart/AddToCartButton.tsx
'use client';

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { useCart } from '@/lib/api/queries/useCart';
import { toast } from 'sonner';

/**
 * Add to cart button - Client Component
 *
 * @author AI
 */
export function AddToCartButton({ productId }: { productId: number }) {
  const [isLoading, setIsLoading] = useState(false);
  const { addItemMutation } = useCart();

  const handleAddToCart = async () => {
    setIsLoading(true);
    try {
      await addItemMutation.mutateAsync({ productId, quantity: 1 });
      toast.success('Product added to cart!');
    } catch (error) {
      toast.error('Failed to add product to cart');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Button onClick={handleAddToCart} disabled={isLoading}>
      {isLoading ? 'Adding...' : 'Add to Cart'}
    </Button>
  );
}
```

### 4.3 Component Props với TypeScript

```typescript
// types/product.types.ts
export interface Product {
  id: number;
  name: string;
  price: number;
  imageUrl: string;
  description: string;
}

export interface ProductCardProps {
  product: Product;
  onAddToCart?: (productId: number) => void;
  className?: string;
}

// components/features/product/ProductCard.tsx
export function ProductCard({ product, onAddToCart, className }: ProductCardProps) {
  return (
    <div className={cn('rounded-lg border p-4', className)}>
      {/* ... */}
    </div>
  );
}
```

---

## 5. State Management

### 5.1 Server State (React Query)

```typescript
// lib/api/queries/useCart.ts
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { cartApi } from '../endpoints';

export function useCart() {
  const queryClient = useQueryClient();

  const cartQuery = useQuery({
    queryKey: ['cart'],
    queryFn: cartApi.getCart,
    staleTime: 5 * 60 * 1000, // 5 minutes
  });

  const addItemMutation = useMutation({
    mutationFn: cartApi.addItem,
    onSuccess: () => {
      // Invalidate cart query to refetch
      queryClient.invalidateQueries({ queryKey: ['cart'] });
    },
  });

  return {
    cart: cartQuery.data,
    isLoading: cartQuery.isLoading,
    addItemMutation,
  };
}
```

### 5.2 Client State (Zustand)

```typescript
// lib/stores/authStore.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface AuthState {
  user: User | null;
  accessToken: string | null;
  setUser: (user: User) => void;
  setAccessToken: (token: string) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      accessToken: null,
      setUser: (user) => set({ user }),
      setAccessToken: (token) => set({ accessToken: token }),
      logout: () => set({ user: null, accessToken: null }),
    }),
    {
      name: 'auth-storage',
    }
  )
);
```

---

## 6. Data Fetching

### 6.1 API Client Setup

```typescript
// lib/api/client.ts
import axios from 'axios';
import { useAuthStore } from '@/lib/stores/authStore';

const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api/v1';

export const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor: Add auth token
apiClient.interceptors.request.use((config) => {
  const token = useAuthStore.getState().accessToken;
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Response interceptor: Handle errors
apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      useAuthStore.getState().logout();
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);
```

### 6.2 API Endpoints

```typescript
// lib/api/endpoints.ts
import { apiClient } from './client';
import type { Cart, AddCartItemDto, Product } from '@/types';

export const cartApi = {
  getCart: async (): Promise<Cart> => {
    const { data } = await apiClient.get('/cart');
    return data;
  },

  addItem: async (dto: AddCartItemDto): Promise<Cart> => {
    const { data } = await apiClient.post('/cart/items/add', dto);
    return data;
  },

  removeItem: async (itemId: number): Promise<Cart> => {
    const { data } = await apiClient.delete(`/cart/items/${itemId}/remove`);
    return data;
  },
};

export const productApi = {
  getProducts: async (params: { page?: number; size?: number }): Promise<Product[]> => {
    const { data } = await apiClient.get('/products', { params });
    return data;
  },

  getProductById: async (id: number): Promise<Product> => {
    const { data } = await apiClient.get(`/products/${id}`);
    return data;
  },
};
```

---

## 7. Form Handling với React Hook Form + Zod

```typescript
// components/features/auth/LoginForm.tsx
'use client';

import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';

// Validation schema
const loginSchema = z.object({
  email: z.string().email({ message: 'EMAIL_INVALID' }),
  password: z.string().min(6, { message: 'PASSWORD_TOO_SHORT' }),
});

type LoginFormData = z.infer<typeof loginSchema>;

export function LoginForm() {
  const {
    register,
    handleSubmit,
    formState: { errors, isSubmitting },
  } = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
  });

  const onSubmit = async (data: LoginFormData) => {
    try {
      // Call login API
      await authApi.login(data);
    } catch (error) {
      console.error('Login failed:', error);
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
      <div>
        <Input {...register('email')} type="email" placeholder="Email" />
        {errors.email && <p className="text-sm text-red-500">{errors.email.message}</p>}
      </div>

      <div>
        <Input {...register('password')} type="password" placeholder="Password" />
        {errors.password && <p className="text-sm text-red-500">{errors.password.message}</p>}
      </div>

      <Button type="submit" disabled={isSubmitting}>
        {isSubmitting ? 'Logging in...' : 'Login'}
      </Button>
    </form>
  );
}
```

---

## 8. Styling với Tailwind CSS

### 8.1 Utility-First Approach

```typescript
// ✅ CORRECT: Use Tailwind utilities
export function ProductCard({ product }: ProductCardProps) {
  return (
    <div className="rounded-lg border border-gray-200 p-4 hover:shadow-lg transition-shadow">
      <img
        src={product.imageUrl}
        alt={product.name}
        className="w-full h-48 object-cover rounded-md mb-4"
      />
      <h3 className="text-lg font-semibold text-gray-900">{product.name}</h3>
      <p className="text-sm text-gray-600 line-clamp-2">{product.description}</p>
      <p className="text-xl font-bold text-blue-600 mt-2">${product.price}</p>
    </div>
  );
}
```

### 8.2 Using cn() Utility

```typescript
// lib/utils/cn.ts
import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

// Usage
<Button className={cn('bg-blue-500', isActive && 'bg-green-500', className)}>
  Click me
</Button>
```

---

## 9. Error Handling

### 9.1 Error Boundary

```typescript
// components/common/ErrorBoundary.tsx
'use client';

import { Component, ReactNode } from 'react';

interface Props {
  children: ReactNode;
}

interface State {
  hasError: boolean;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError() {
    return { hasError: true };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="flex items-center justify-center min-h-screen">
          <div className="text-center">
            <h2 className="text-2xl font-bold mb-4">Something went wrong</h2>
            <button
              onClick={() => this.setState({ hasError: false })}
              className="px-4 py-2 bg-blue-500 text-white rounded"
            >
              Try again
            </button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

---

## 10. Performance Optimization

### 10.1 Lazy Loading

```typescript
// Dynamic imports for code splitting
import dynamic from 'next/dynamic';

const ProductReviews = dynamic(() => import('@/components/features/product/ProductReviews'), {
  loading: () => <p>Loading reviews...</p>,
  ssr: false, // Client-side only
});
```

### 10.2 Image Optimization

```typescript
import Image from 'next/image';

export function ProductCard({ product }: ProductCardProps) {
  return (
    <Image
      src={product.imageUrl}
      alt={product.name}
      width={400}
      height={300}
      className="rounded-lg"
      priority={false} // Lazy load
      placeholder="blur"
      blurDataURL="/placeholder.jpg"
    />
  );
}
```

---

## 11. Environment Variables

```bash
# .env.local
NEXT_PUBLIC_API_URL=https://api.example.com/api/v1
NEXT_PUBLIC_SITE_URL=https://example.com
NEXT_PUBLIC_GOOGLE_ANALYTICS_ID=G-XXXXXXXXXX

# Server-only (no NEXT_PUBLIC_ prefix)
DATABASE_URL=postgresql://...
API_SECRET_KEY=...
```

```typescript
// config/env.ts
export const env = {
  apiUrl: process.env.NEXT_PUBLIC_API_URL!,
  siteUrl: process.env.NEXT_PUBLIC_SITE_URL!,
  gaId: process.env.NEXT_PUBLIC_GOOGLE_ANALYTICS_ID,
} as const;
```

---

## 12. Testing

### 12.1 Component Testing (Jest + Testing Library)

```typescript
// components/features/cart/AddToCartButton.test.tsx
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { AddToCartButton } from './AddToCartButton';
import { useCart } from '@/lib/api/queries/useCart';

jest.mock('@/lib/api/queries/useCart');

describe('AddToCartButton', () => {
  it('test_addToCartButton_onClick_callsAddItemMutation', async () => {
    const mockAddItemMutation = jest.fn().mockResolvedValue({});
    (useCart as jest.Mock).mockReturnValue({
      addItemMutation: { mutateAsync: mockAddItemMutation },
    });

    render(<AddToCartButton productId={123} />);

    const button = screen.getByRole('button', { name: /add to cart/i });
    fireEvent.click(button);

    await waitFor(() => {
      expect(mockAddItemMutation).toHaveBeenCalledWith({ productId: 123, quantity: 1 });
    });
  });
});
```

---

**Version:** 1.0
**Framework:** Next.js 14.x (App Router)
**Last Updated:** 2026-01-09
