# HLD - TM-JOURNEY (Time Machine - Journey Experience)

## 1. B·ªëi c·∫£nh (Context)

### 1.1 B·ªëi c·∫£nh v·ªÅ kinh doanh (Business Context)

**Journey Experience** l√† t√≠nh nƒÉng c·ªët l√µi c·ªßa kynguyenAI.vn - m·ªôt tr·∫£i nghi·ªám web t∆∞∆°ng t√°c s·ª≠ d·ª•ng k·ªπ thu·∫≠t Scrollytelling ƒë·ªÉ ƒë∆∞a ng∆∞·ªùi d√πng xuy√™n qua th·ªùi gian t·ª´ nƒÉm 2026 ƒë·∫øn 2045, h√¨nh dung t∆∞∆°ng lai c·ªßa Vi·ªát Nam v√† c·ªßa ch√≠nh h·ªç.

**M·ª•c ti√™u kinh doanh:**
- T·∫°o tr·∫£i nghi·ªám "Wow Factor" ƒë·ªôc nh·∫•t tr√™n th·ªã tr∆∞·ªùng AI Vi·ªát Nam
- Thu h√∫t v√† gi·ªØ ch√¢n ng∆∞·ªùi d√πng th√¥ng qua storytelling immersive
- T·∫°o ra "Viral Asset" (B∆∞u thi·∫øp 2045) ƒë·ªÉ ng∆∞·ªùi d√πng chia s·∫ª
- Chuy·ªÉn ƒë·ªïi ng∆∞·ªùi d√πng t·ª´ Free sang Premium tier

**User Journey Overview:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         JOURNEY USER FLOW                                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                               ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ   ‚îÇ  LANDING    ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  CONFIGURE  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  SCROLLING  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ  POSTCARD   ‚îÇ  ‚îÇ
‚îÇ   ‚îÇ  PAGE       ‚îÇ    ‚îÇ  JOURNEY    ‚îÇ    ‚îÇ  EXPERIENCE ‚îÇ    ‚îÇ  REVEAL     ‚îÇ  ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                                               ‚îÇ
‚îÇ   ‚Ä¢ 3D Globe         ‚Ä¢ Location         ‚Ä¢ 2026 ‚Üí 2045     ‚Ä¢ AI Image Gen   ‚îÇ
‚îÇ   ‚Ä¢ Hero CTA         ‚Ä¢ Profession       ‚Ä¢ AI Narrative    ‚Ä¢ Share buttons  ‚îÇ
‚îÇ   ‚Ä¢ Social Proof     ‚Ä¢ Lifestyle        ‚Ä¢ Parallax FX     ‚Ä¢ Chat CTA       ‚îÇ
‚îÇ                                                                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**C√°c ƒë·ªãa ƒëi·ªÉm ƒë∆∞·ª£c h·ªó tr·ª£:**

| ID | T√™n | M√¥ t·∫£ | Quy ho·∫°ch tham chi·∫øu |
|----|-----|-------|---------------------|
| `can-gio` | Th√†nh ph·ªë bi·ªÉn C·∫ßn Gi·ªù | ƒê√¥ th·ªã du l·ªãch sinh th√°i l·∫•n bi·ªÉn | Quy ho·∫°ch TP.HCM 2040-2060 |
| `thu-duc` | Trung t√¢m ƒê·ªïi m·ªõi Th·ªß ƒê·ª©c | Silicon Valley c·ªßa Vi·ªát Nam | Th√†nh ph·ªë Th·ªß ƒê·ª©c |
| `hanoi` | ƒê√¥ th·ªã S√¥ng H·ªìng H√† N·ªôi | Th√†nh ph·ªë trong s√¥ng | Quy ho·∫°ch H√† N·ªôi 2065 |

**C√°c ngh·ªÅ nghi·ªáp/ƒëam m√™ ƒë∆∞·ª£c h·ªó tr·ª£:**

| Category | Options |
|----------|---------|
| **C√¥ng ngh·ªá** | L·∫≠p tr√¨nh vi√™n l∆∞·ª£ng t·ª≠, K·ªπ s∆∞ AI, Ki·∫øn tr√∫c s∆∞ metaverse |
| **S√°ng t·∫°o** | Ngh·ªá nh√¢n s·ªë, Nh√† thi·∫øt k·∫ø sinh th√°i, Content creator |
| **Sinh th√°i** | N√¥ng d√¢n ƒë√¥ th·ªã, K·ªπ s∆∞ m√¥i tr∆∞·ªùng, Nh√† nghi√™n c·ª©u bi·ªÉn |
| **Gi√°o d·ª•c** | Gi√°o vi√™n t∆∞∆°ng lai, Nh√† nghi√™n c·ª©u, Mentor AI |
| **Kh√°c** | Doanh nh√¢n x√£ h·ªôi, B√°c sƒ© telemedicine, Ki·∫øn tr√∫c s∆∞ |

**Phong c√°ch s·ªëng:**

| ID | T√™n | Prompt modifier |
|----|-----|-----------------|
| `peaceful` | Y√™n b√¨nh | Serene, minimalist, garden views |
| `vibrant` | S√¥i ƒë·ªông | Bustling, neon accents, urban energy |
| `connected` | K·∫øt n·ªëi | Community-focused, co-working, social spaces |

### 1.2 B·ªëi c·∫£nh v·ªÅ h·ªá th·ªëng (System Context)

#### C√°c th√†nh ph·∫ßn Web Application:

| Layer | Component | Technology | M√¥ t·∫£ |
|-------|-----------|------------|-------|
| **WEB** | kynguyenai-web | Next.js 15 | Main application |
| **PAGE** | /journey | React + GSAP | Configuration page |
| **PAGE** | /journey/[sessionId] | React + GSAP ScrollTrigger | Scrollytelling experience |
| **PAGE** | /journey/[sessionId]/postcard | React | Final postcard reveal |

#### Backend Services:

| Endpoint | Method | M√¥ t·∫£ |
|----------|--------|-------|
| `/api/journey/start` | POST | Kh·ªüi t·∫°o journey session |
| `/api/journey/milestone` | GET | L·∫•y narrative cho c·ªôt m·ªëc (streaming) |
| `/api/journey/complete` | POST | ƒê√°nh d·∫•u journey ho√†n th√†nh |
| `/api/ai/generate-narrative` | POST | Generate text v·ªõi LLM (internal) |
| `/api/ai/generate-postcard` | POST | Generate image v·ªõi Flux (internal) |

#### External Services:

| Service | M√¥ t·∫£ |
|---------|-------|
| **OpenAI / Anthropic** | LLM cho narrative generation |
| **Replicate / Fal.ai** | Image generation (Flux Pro) |
| **Supabase** | Database + Auth + Storage |
| **Vercel KV** | Session caching |

### 1.3 Ph·∫°m vi ngo√†i (Out Of Scope)

| STT | N·ªôi dung | L√Ω do |
|-----|----------|-------|
| 1 | User Registration | Xem HLD-UM-AUTH |
| 2 | Payment Processing | Xem HLD-UM-SUBSCRIPTION |
| 3 | Chatbot Integration | Xem HLD-CB-FUTURE-SELF |
| 4 | 3D Globe Details | Xem HLD-UX-3D-VISUALIZATION |
| 5 | Animation Technical Details | Xem HLD-UX-SCROLLYTELLING |

### 1.4 C√°c ch√¢n dung (Actors)

| Actor | M√¥ t·∫£ | H√†nh ƒë·ªông ch√≠nh |
|-------|-------|-----------------|
| **Anonymous User** | Ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p | Tr·∫£i nghi·ªám journey (gi·ªõi h·∫°n 3/ng√†y) |
| **Registered User** | Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng k√Ω | Tr·∫£i nghi·ªám journey (theo tier) |
| **Premium User** | Ng∆∞·ªùi d√πng tr·∫£ ph√≠ | Unlimited journeys, 4K postcards |
| **System** | Background processes | Trigger AI generation, cleanup sessions |

---

## 2. Context Diagram

```mermaid
C4Context
    title Context Diagram - Journey Experience

    Person(user, "User", "Ng∆∞·ªùi d√πng tr·∫£i nghi·ªám h√†nh tr√¨nh 2045")

    System_Boundary(journey, "Journey System") {
        System(web, "kynguyenai-web", "Next.js Frontend")
        System(api, "Journey API", "API Routes")
        System(state, "Journey State", "Zustand Store")
    }

    System_Ext(aiText, "AI Text Service", "LLM Narrative Generation")
    System_Ext(aiImage, "AI Image Service", "Postcard Generation")
    System_Ext(db, "Supabase", "Database + Storage")
    System_Ext(cache, "Vercel KV", "Session Cache")

    Rel(user, web, "Scrolls through timeline")
    Rel(web, state, "Updates progress")
    Rel(web, api, "Requests narratives/postcards")
    Rel(api, aiText, "Generate milestone text")
    Rel(api, aiImage, "Generate postcard image")
    Rel(api, db, "Store journey data")
    Rel(api, cache, "Cache session state")
```

---

## 3. Core Business Workflow

### 3.1 Sequence Diagram - Start Journey

```mermaid
sequenceDiagram
    autonumber
    participant User
    participant Web as kynguyenai-web
    participant Store as Zustand Store
    participant API as /api/journey/start
    participant DB as Supabase
    participant Cache as Vercel KV

    User->>Web: Access /journey
    Web->>Web: Display configuration form

    User->>Web: Select location, profession, lifestyle
    Web->>Store: Update local state

    User->>Web: Click "B·∫Øt ƒë·∫ßu H√†nh tr√¨nh"
    Web->>API: POST /api/journey/start
    Note over API: { location, profession, lifestyle, userId? }

    API->>API: Validate inputs
    API->>API: Check user quota (if authenticated)

    alt Quota exceeded
        API-->>Web: 429 Too Many Requests
        Web-->>User: "B·∫°n ƒë√£ h·∫øt l∆∞·ª£t h√¥m nay"
    end

    API->>DB: INSERT journey_session
    DB-->>API: Return session with ID

    API->>Cache: SET session:{id} (TTL: 1 hour)

    API-->>Web: { sessionId, estimatedDuration }
    Web->>Store: Set sessionId
    Web->>Web: Navigate to /journey/{sessionId}
```

### 3.2 Sequence Diagram - Scrollytelling Experience

```mermaid
sequenceDiagram
    autonumber
    participant User
    participant Web as Journey Page
    participant GSAP as GSAP ScrollTrigger
    participant Store as Zustand Store
    participant API as /api/journey/milestone
    participant AI as AI Text Service

    User->>Web: Load /journey/{sessionId}
    Web->>Store: Initialize with session data

    loop User scrolls through timeline
        User->>GSAP: Scroll event
        GSAP->>GSAP: Calculate scroll progress
        GSAP->>Store: Update currentYear, scrollProgress

        alt Year milestone reached (2030, 2035, 2040, 2045)
            Store->>Web: Trigger milestone fetch
            Web->>API: GET /api/journey/milestone?year={year}

            API->>API: Build meta-prompt with location data
            API->>AI: streamText({ prompt, userContext })

            loop Streaming response
                AI-->>API: Text chunk
                API-->>Web: SSE: data chunk
                Web->>Web: Append to narrative display
            end

            Web->>Store: Cache milestone content
        end

        GSAP->>Web: Update parallax layers
        GSAP->>Web: Update year indicator
    end

    Note over User,Web: User reaches 2045 (100% scroll)
    Web->>Web: Trigger postcard generation
```

### 3.3 Sequence Diagram - Postcard Generation

```mermaid
sequenceDiagram
    autonumber
    participant User
    participant Web as Journey Page
    participant API as /api/ai/generate-postcard
    participant Builder as Prompt Builder
    participant AI as Image AI (Flux)
    participant Storage as Supabase Storage
    participant DB as Supabase DB

    Web->>API: POST /api/ai/generate-postcard
    Note over API: { sessionId, resolution: '1080' | '4k' }

    API->>DB: Get journey_session data
    DB-->>API: { location, profession, lifestyle }

    API->>Builder: constructImagePrompt(sessionData)
    Builder->>Builder: Load location-specific keywords
    Builder->>Builder: Apply Solarpunk aesthetic
    Builder->>Builder: Add profession context
    Builder-->>API: Full prompt string

    API->>AI: Generate image (Flux Pro)
    Note over AI: ~10-15 seconds

    AI-->>API: Image binary

    API->>API: Apply watermark (kynguyenAI.vn)
    API->>Storage: Upload to postcards bucket
    Storage-->>API: { publicUrl }

    API->>DB: INSERT postcards record
    Note over DB: { sessionId, imageUrl, prompt, shareCount: 0 }

    API-->>Web: { imageUrl, thumbnailUrl, shareUrl }

    Web->>Web: Display postcard with reveal animation
    Web->>User: Show share buttons
```

---

## 4. State Machine

### 4.1 Journey Session State

```mermaid
stateDiagram-v2
    [*] --> IDLE: User visits /journey

    IDLE --> CONFIGURING: User starts configuration

    CONFIGURING --> CONFIGURING: Update choices
    CONFIGURING --> READY: All fields filled

    READY --> STARTED: Click "B·∫Øt ƒë·∫ßu"

    STARTED --> SCROLLING: Session created

    SCROLLING --> MILESTONE_2030: Scroll 10-30%
    MILESTONE_2030 --> SCROLLING: Continue

    SCROLLING --> MILESTONE_2035: Scroll 30-50%
    MILESTONE_2035 --> SCROLLING: Continue

    SCROLLING --> MILESTONE_2040: Scroll 50-70%
    MILESTONE_2040 --> SCROLLING: Continue

    SCROLLING --> MILESTONE_2045: Scroll 70-100%
    MILESTONE_2045 --> GENERATING_POSTCARD: Auto-trigger

    GENERATING_POSTCARD --> COMPLETED: Image ready
    GENERATING_POSTCARD --> ERROR: Generation failed

    COMPLETED --> SHARED: User shares
    COMPLETED --> CHAT_STARTED: User opens chat

    ERROR --> SCROLLING: Retry
    ERROR --> ABANDONED: User leaves

    COMPLETED --> [*]
    ABANDONED --> [*]
```

### 4.2 State Transitions

| From State | To State | Trigger | Action |
|------------|----------|---------|--------|
| IDLE | CONFIGURING | User interaction | Show form |
| CONFIGURING | READY | All fields valid | Enable start button |
| READY | STARTED | Click start | API call to create session |
| STARTED | SCROLLING | Session created | Navigate to journey page |
| SCROLLING | MILESTONE_XXXX | Scroll threshold | Fetch narrative |
| MILESTONE_2045 | GENERATING_POSTCARD | Reach 100% | Auto-generate |
| GENERATING_POSTCARD | COMPLETED | Image ready | Show postcard |
| COMPLETED | SHARED | Click share | Track share event |

---

## 5. Data Model (ERD)

### 5.1 Entity Relationship Diagram

```mermaid
erDiagram
    users ||--o{ journey_sessions : creates
    journey_sessions ||--o{ milestones : contains
    journey_sessions ||--o| postcards : generates
    journey_sessions ||--o| chat_sessions : starts

    users {
        uuid id PK
        string email
        string name
        timestamp created_at
    }

    journey_sessions {
        uuid id PK
        uuid user_id FK
        string location
        string profession
        string lifestyle
        integer current_year
        integer scroll_progress
        enum status
        timestamp started_at
        timestamp completed_at
    }

    milestones {
        uuid id PK
        uuid session_id FK
        integer year
        text narrative
        jsonb metadata
        timestamp generated_at
    }

    postcards {
        uuid id PK
        uuid session_id FK
        string image_url
        string thumbnail_url
        text prompt_used
        string resolution
        integer share_count
        timestamp created_at
    }

    locations {
        string id PK
        string name
        text description
        jsonb planning_data
        jsonb prompt_keywords
    }

    daily_usage {
        uuid id PK
        uuid user_id FK
        date usage_date
        integer journeys_count
        integer images_count
    }
```

### 5.2 Table Definitions

```sql
-- Journey Sessions
CREATE TABLE journey_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    location VARCHAR(50) NOT NULL,
    profession VARCHAR(100) NOT NULL,
    lifestyle VARCHAR(50) NOT NULL,
    current_year INTEGER DEFAULT 2026 CHECK (current_year >= 2026 AND current_year <= 2045),
    scroll_progress INTEGER DEFAULT 0 CHECK (scroll_progress >= 0 AND scroll_progress <= 100),
    status VARCHAR(30) DEFAULT 'STARTED',
    started_at TIMESTAMPTZ DEFAULT NOW(),
    completed_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_journey_sessions_user ON journey_sessions(user_id);
CREATE INDEX idx_journey_sessions_status ON journey_sessions(status);
CREATE INDEX idx_journey_sessions_created ON journey_sessions(created_at DESC);

-- Milestones (cached narratives)
CREATE TABLE milestones (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id UUID NOT NULL REFERENCES journey_sessions(id) ON DELETE CASCADE,
    year INTEGER NOT NULL CHECK (year IN (2030, 2035, 2040, 2045)),
    narrative TEXT NOT NULL,
    metadata JSONB DEFAULT '{}',
    generated_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(session_id, year)
);

-- Postcards
CREATE TABLE postcards (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id UUID NOT NULL REFERENCES journey_sessions(id) ON DELETE CASCADE,
    image_url TEXT NOT NULL,
    thumbnail_url TEXT,
    prompt_used TEXT NOT NULL,
    resolution VARCHAR(10) DEFAULT '1080',
    share_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Locations (Knowledge Base)
CREATE TABLE locations (
    id VARCHAR(50) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    planning_data JSONB NOT NULL,
    prompt_keywords JSONB NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- Daily Usage Tracking
CREATE TABLE daily_usage (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES auth.users(id),
    anonymous_id VARCHAR(100),
    usage_date DATE NOT NULL DEFAULT CURRENT_DATE,
    journeys_count INTEGER DEFAULT 0,
    images_count INTEGER DEFAULT 0,
    UNIQUE(user_id, usage_date),
    UNIQUE(anonymous_id, usage_date)
);
```

### 5.3 Sample Data

```json
// journey_sessions
{
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "user_id": null,
    "location": "thu-duc",
    "profession": "L·∫≠p tr√¨nh vi√™n l∆∞·ª£ng t·ª≠",
    "lifestyle": "vibrant",
    "current_year": 2045,
    "scroll_progress": 100,
    "status": "COMPLETED",
    "started_at": "2025-01-15T10:30:00Z",
    "completed_at": "2025-01-15T10:35:00Z"
}

// locations
{
    "id": "thu-duc",
    "name": "Trung t√¢m ƒê·ªïi m·ªõi Th·ªß ƒê·ª©c",
    "description": "Silicon Valley c·ªßa Vi·ªát Nam",
    "planning_data": {
        "area_km2": 211,
        "population_2045": 1500000,
        "key_projects": ["Innovation District", "Metro Lines 1-2", "AI Research Hub"],
        "green_coverage": 40
    },
    "prompt_keywords": {
        "architecture": ["gleaming skyscrapers", "vertical gardens", "smart buildings"],
        "transport": ["autonomous vehicles", "drone delivery", "monorail"],
        "atmosphere": ["innovation hub", "startup ecosystem", "tech campus"]
    }
}
```

---

## 6. Event Architecture

### 6.1 Event Catalog

| Event | Publisher | Consumers | M√¥ t·∫£ |
|-------|-----------|-----------|-------|
| `journey.started` | Journey API | Analytics, Usage Tracker | Journey b·∫Øt ƒë·∫ßu |
| `journey.milestone.reached` | Journey API | Analytics | User ƒë·∫°t c·ªôt m·ªëc nƒÉm |
| `journey.completed` | Journey API | Analytics, Notification | Journey ho√†n th√†nh |
| `postcard.generated` | Image API | Analytics, Storage | Postcard ƒë∆∞·ª£c t·∫°o |
| `postcard.shared` | Frontend | Analytics, Viral Tracker | User chia s·∫ª postcard |

### 6.2 Event Payloads

```typescript
// journey.started
interface JourneyStartedEvent {
    eventType: 'journey.started';
    timestamp: string;
    payload: {
        sessionId: string;
        userId: string | null;
        location: string;
        profession: string;
        lifestyle: string;
        isAnonymous: boolean;
    };
}

// journey.completed
interface JourneyCompletedEvent {
    eventType: 'journey.completed';
    timestamp: string;
    payload: {
        sessionId: string;
        userId: string | null;
        durationSeconds: number;
        postcardGenerated: boolean;
    };
}

// postcard.shared
interface PostcardSharedEvent {
    eventType: 'postcard.shared';
    timestamp: string;
    payload: {
        postcardId: string;
        sessionId: string;
        platform: 'facebook' | 'twitter' | 'linkedin' | 'copy_link';
        referrer: string;
    };
}
```

---

## 7. API Contracts

### 7.1 POST /api/journey/start

**Request:**
```typescript
interface StartJourneyRequest {
    location: 'can-gio' | 'thu-duc' | 'hanoi';
    profession: string;
    lifestyle: 'peaceful' | 'vibrant' | 'connected';
}
```

**Response (201 Created):**
```typescript
interface StartJourneyResponse {
    sessionId: string;
    estimatedDuration: number; // minutes
    location: {
        id: string;
        name: string;
    };
}
```

**Error Responses:**

| Status | Code | Message |
|--------|------|---------|
| 400 | INVALID_INPUT | Missing or invalid fields |
| 429 | QUOTA_EXCEEDED | Daily limit reached |
| 500 | INTERNAL_ERROR | Server error |

### 7.2 GET /api/journey/milestone

**Request:**
```
GET /api/journey/milestone?sessionId={sessionId}&year={year}
Accept: text/event-stream
```

**Response (SSE Stream):**
```
event: start
data: {"year": 2030, "status": "generating"}

event: delta
data: {"content": "NƒÉm 2030, "}

event: delta
data: {"content": "tuy·∫øn Metro s·ªë 2 "}

event: delta
data: {"content": "B·∫øn Th√†nh - Tham L∆∞∆°ng ƒë√£ ho√†n thi·ªán..."}

event: complete
data: {"year": 2030, "totalTokens": 150}
```

### 7.3 POST /api/ai/generate-postcard

**Request:**
```typescript
interface GeneratePostcardRequest {
    sessionId: string;
    resolution: '1080' | '4k';
}
```

**Response (200 OK):**
```typescript
interface GeneratePostcardResponse {
    postcardId: string;
    imageUrl: string;
    thumbnailUrl: string;
    shareUrl: string;
    prompt: string;
    generationTime: number; // seconds
}
```

---

## 8. UI Wireframes

### 8.1 Configuration Page (/journey)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  kynguyenAI.vn                                    [ƒêƒÉng nh·∫≠p]   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                   ‚îÇ
‚îÇ          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ          ‚îÇ                                         ‚îÇ             ‚îÇ
‚îÇ          ‚îÇ         üåè [3D Globe Animation]         ‚îÇ             ‚îÇ
‚îÇ          ‚îÇ                                         ‚îÇ             ‚îÇ
‚îÇ          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     "B·∫°n th·∫•y m√¨nh ·ªü ƒë√¢u khi Vi·ªát Nam k·ª∑ ni·ªám                   ‚îÇ
‚îÇ      100 nƒÉm th√†nh l·∫≠p n∆∞·ªõc v√†o nƒÉm 2045?"                      ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ     ‚îÇ üìç Ch·ªçn ƒë·ªãa ƒëi·ªÉm                                      ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ   ‚óã Th√†nh ph·ªë bi·ªÉn C·∫ßn Gi·ªù                            ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ   ‚óè Trung t√¢m ƒê·ªïi m·ªõi Th·ªß ƒê·ª©c                         ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ   ‚óã ƒê√¥ th·ªã S√¥ng H·ªìng H√† N·ªôi                           ‚îÇ   ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ     ‚îÇ üíº Ngh·ªÅ nghi·ªáp / ƒêam m√™                               ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ   [L·∫≠p tr√¨nh vi√™n l∆∞·ª£ng t·ª≠              ‚ñº]           ‚îÇ   ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ     ‚îÇ üé® Phong c√°ch s·ªëng                                    ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ   ‚óã Y√™n b√¨nh    ‚óè S√¥i ƒë·ªông    ‚óã K·∫øt n·ªëi              ‚îÇ   ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ                  ‚îÇ   üöÄ B·∫Øt ƒë·∫ßu H√†nh tr√¨nh  ‚îÇ                     ‚îÇ
‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ                     C√≤n 3 l∆∞·ª£t mi·ªÖn ph√≠ h√¥m nay                  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 8.2 Scrollytelling Experience (/journey/[sessionId])

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ                                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ         [PARALLAX BACKGROUND - Thu Duc 2035]               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ         Wireframe buildings + blueprints                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                            ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë                                                  ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë   "NƒÉm 2035, Trung t√¢m ƒê·ªïi m·ªõi Th·ªß ƒê·ª©c          ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë   ƒë√£ tr·ªü th√†nh ƒëi·ªÉm ƒë·∫øn c·ªßa c√°c startup         ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë   c√¥ng ngh·ªá h√†ng ƒë·∫ßu ch√¢u √Å. B·∫°n, v·ªõi           ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë   vai tr√≤ L·∫≠p tr√¨nh vi√™n l∆∞·ª£ng t·ª≠, ƒëang         ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë   l√†m vi·ªác t·∫°i m·ªôt trong nh·ªØng quantum          ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë   labs ti√™n ti·∫øn nh·∫•t..."                       ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë                        [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë]           ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïë                        (Streaming...)           ‚ïë   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                                                            ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ  2026    2030    2035    2040    2045                      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   ‚óã‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óã‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óã‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óã                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ                   ‚Üë                                        ‚îÇ ‚îÇ
‚îÇ  ‚îÇ               B·∫°n ƒëang ·ªü ƒë√¢y                               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ          ‚ñº Cu·ªôn xu·ªëng ƒë·ªÉ ti·∫øp t·ª•c h√†nh tr√¨nh ‚ñº                  ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 8.3 Postcard Reveal

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                                                   ‚îÇ
‚îÇ                    üéâ CH√ÄO M·ª™NG ƒê·∫æN NƒÇM 2045!                    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ     ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ         [AI GENERATED POSTCARD IMAGE]                 ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ         Solarpunk Thu Duc 2045                        ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ         Quantum Lab with vertical gardens             ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ                                                       ‚îÇ   ‚îÇ
‚îÇ     ‚îÇ                              kynguyenAI.vn           ‚îÇ   ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ                  "B∆∞u thi·∫øp t·ª´ T∆∞∆°ng lai c·ªßa b·∫°n"               ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ     ‚îÇ Facebook ‚îÇ  ‚îÇ Twitter ‚îÇ  ‚îÇLinkedIn ‚îÇ  ‚îÇ  Copy   ‚îÇ         ‚îÇ
‚îÇ     ‚îÇ   Share  ‚îÇ  ‚îÇ  Share  ‚îÇ  ‚îÇ  Share  ‚îÇ  ‚îÇ  Link   ‚îÇ         ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ     ‚îÇ  üí¨ Tr√≤ chuy·ªán v·ªõi B·∫£n th·ªÉ T∆∞∆°ng lai c·ªßa b·∫°n ‚Üí        ‚îÇ   ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ     ‚îÇ  üîÑ T·∫°o h√†nh tr√¨nh m·ªõi                                ‚îÇ   ‚îÇ
‚îÇ     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 9. Integration Points

### 9.1 Internal Integrations

| Service | Integration Type | M√¥ t·∫£ |
|---------|-----------------|-------|
| **HLD-AI-TEXT-GENERATION** | API Call | G·ªçi ƒë·ªÉ generate narrative t·∫°i m·ªói milestone |
| **HLD-AI-IMAGE-GENERATION** | API Call | G·ªçi ƒë·ªÉ generate postcard khi ho√†n th√†nh |
| **HLD-CB-FUTURE-SELF** | Navigation | Redirect sang chatbot sau khi xem postcard |
| **HLD-UX-SCROLLYTELLING** | Component | S·ª≠ d·ª•ng GSAP components |
| **HLD-UM-AUTH** | Middleware | Check authentication state |
| **HLD-UM-SUBSCRIPTION** | API Call | Check quota v√† tier |
| **HLD-AN-VIRAL-METRICS** | Event | Track share events |

### 9.2 External Integrations

| Service | Purpose | Fallback |
|---------|---------|----------|
| **OpenAI/Anthropic** | Text generation | Switch provider |
| **Replicate/Fal.ai** | Image generation | Switch provider |
| **Supabase** | Database + Auth | N/A (critical) |
| **Vercel KV** | Session cache | Use DB directly |

---

## 10. Non-Functional Requirements

### 10.1 Performance

| Metric | Target | Measurement |
|--------|--------|-------------|
| **Page Load (LCP)** | < 2.5s | Core Web Vitals |
| **Scroll FPS** | 60 fps | Chrome DevTools |
| **Text Streaming TTFB** | < 500ms | API monitoring |
| **Image Generation** | < 15s | API monitoring |
| **Total Journey Time** | 3-5 minutes | User analytics |

### 10.2 Scalability

| Aspect | Target |
|--------|--------|
| **Concurrent Users** | 1,000+ |
| **Daily Journeys** | 10,000+ |
| **Image Generations/day** | 5,000+ |
| **Database Connections** | Supabase pooling |

### 10.3 Reliability

| Metric | Target |
|--------|--------|
| **Uptime** | 99.9% |
| **Error Rate** | < 1% |
| **AI Fallback** | Auto-switch providers |

### 10.4 Security

| Aspect | Implementation |
|--------|----------------|
| **Rate Limiting** | 3 journeys/day (free), unlimited (premium) |
| **Input Validation** | Zod schema validation |
| **Content Moderation** | AI-generated content filters |
| **Session Security** | Short-lived tokens, no PII in URLs |

### 10.5 SEO & Social

| Aspect | Implementation |
|--------|----------------|
| **Server Rendering** | Next.js SSR cho metadata |
| **Open Graph** | Dynamic OG images cho shared postcards |
| **Schema.org** | WebApplication markup |
| **Sitemap** | Auto-generated |

---

## 11. Ph·ª• l·ª•c (Appendix)

### 11.1 Prompt Template Example

```typescript
const constructNarrativePrompt = (
    location: string,
    profession: string,
    year: number,
    previousContext: string
): string => {
    const locationData = locations[location];

    return `
B·∫°n l√† m·ªôt nh√† t∆∞∆°ng lai h·ªçc chuy√™n v·ªÅ quy ho·∫°ch ƒë√¥ th·ªã Vi·ªát Nam.

## B·ªëi c·∫£nh
- ƒê·ªãa ƒëi·ªÉm: ${locationData.name}
- Ngh·ªÅ nghi·ªáp c·ªßa ng∆∞·ªùi d√πng: ${profession}
- NƒÉm hi·ªán t·∫°i trong c√¢u chuy·ªán: ${year}
- D·ªØ li·ªáu quy ho·∫°ch: ${JSON.stringify(locationData.planningData)}

## Nhi·ªám v·ª•
Vi·∫øt m·ªôt ƒëo·∫°n vƒÉn ng·∫Øn (3-4 c√¢u) m√¥ t·∫£ cu·ªôc s·ªëng c·ªßa ng∆∞·ªùi d√πng t·∫°i ${year}.
- S·ª≠ d·ª•ng ng√¥i th·ª© hai ("B·∫°n")
- Phong c√°ch: Solarpunk, l·∫°c quan, c√¥ng ngh·ªá h√†i h√≤a thi√™n nhi√™n
- T√≠ch h·ª£p c√°c t·ª´ kh√≥a: ${locationData.promptKeywords[year]}
- Ti·∫øp n·ªëi ng·ªØ c·∫£nh tr∆∞·ªõc: "${previousContext}"

## Gi·ªçng vƒÉn
Truy·ªÅn c·∫£m h·ª©ng nh∆∞ng th·ª±c t·∫ø, d·ª±a tr√™n d·ªØ li·ªáu quy ho·∫°ch th·ª±c.
Kh√¥ng s·ª≠ d·ª•ng emoji.
    `.trim();
};
```

### 11.2 Enums

```typescript
enum JourneyStatus {
    IDLE = 'IDLE',
    CONFIGURING = 'CONFIGURING',
    READY = 'READY',
    STARTED = 'STARTED',
    SCROLLING = 'SCROLLING',
    MILESTONE_2030 = 'MILESTONE_2030',
    MILESTONE_2035 = 'MILESTONE_2035',
    MILESTONE_2040 = 'MILESTONE_2040',
    MILESTONE_2045 = 'MILESTONE_2045',
    GENERATING_POSTCARD = 'GENERATING_POSTCARD',
    COMPLETED = 'COMPLETED',
    SHARED = 'SHARED',
    ERROR = 'ERROR',
    ABANDONED = 'ABANDONED'
}

enum Location {
    CAN_GIO = 'can-gio',
    THU_DUC = 'thu-duc',
    HANOI = 'hanoi'
}

enum Lifestyle {
    PEACEFUL = 'peaceful',
    VIBRANT = 'vibrant',
    CONNECTED = 'connected'
}
```

---

**T√†i li·ªáu li√™n quan:**
- [HLD-AI-TEXT-GENERATION.md](./HLD-AI-TEXT-GENERATION.md) - Chi ti·∫øt AI Text Generation
- [HLD-AI-IMAGE-GENERATION.md](./HLD-AI-IMAGE-GENERATION.md) - Chi ti·∫øt AI Image Generation
- [HLD-UX-SCROLLYTELLING.md](./HLD-UX-SCROLLYTELLING.md) - Chi ti·∫øt Animation System
- [HLD-CB-FUTURE-SELF.md](./HLD-CB-FUTURE-SELF.md) - Chi ti·∫øt Chatbot
